{% extends 'base.html' %}
{% load static %}

{% block title %}Actualités – Ecole de Santé Le Bon Berger{% endblock %}

{% block content %}
<style>
  .actualite-scroll {
    max-height: 80vh;
    overflow-y: auto;
    padding-right: 10px;
  }

  .actualite-scroll::-webkit-scrollbar {
    width: 8px;
  }

  .actualite-scroll::-webkit-scrollbar-thumb {
    background-color: #aaa;
    border-radius: 4px;
  }

  .image-facebook-style {
    width: 100%;
    aspect-ratio: 1.91 / 1;
    object-fit: cover;
    border-top-left-radius: .5rem;
    border-top-right-radius: .5rem;
  }

  .voir-plus-btn {
    display: flex;
    justify-content: flex-end;
  }
</style>

<div class="container mt-5">
  <div class="row">
    <!-- Partie principale avec actualités -->
    <div class="col-md-8">
      <div class="actualite-scroll">
        <h2 class="mb-4">📰 Actualités & Résultats</h2>

        {% for act in actualites %}
        <div class="card mb-4 shadow">
          
          {% if act.image %}
            <!-- Image format Facebook style -->
            <img src="{{ act.image.url }}" class="image-facebook-style" alt="Illustration {{ act.titre }}"
                 data-bs-toggle="modal" data-bs-target="#modal-image-{{ act.id }}">
          {% endif %}

          <div class="card-body">
            <h5 class="card-title">{{ act.titre }}</h5>

            <p class="card-text">
              {{ act.contenu|truncatewords:40 }}
            </p>

            {% if act.fichier %}
              <p>
                <a href="{{ act.fichier.url }}" class="btn btn-sm btn-outline-primary" download>
                  Télécharger le document
                </a>
              </p>
            {% endif %}

            <small class="text-muted">🕒 Publié le {{ act.date_publication|date:"d/m/Y à H:i" }}</small>

            <div class="voir-plus-btn mt-3">
              <a href="{% url 'detail_actualite' act.id %}" class="btn btn-sm btn-outline-secondary">
                🔍 Voir plus
              </a>
            </div>
          </div>

          <!-- Modal image -->
          {% if act.image %}
          <div class="modal fade" id="modal-image-{{ act.id }}" tabindex="-1" aria-labelledby="imageModalLabel{{ act.id }}" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="imageModalLabel{{ act.id }}">{{ act.titre }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="modal-body text-center">
                  <img src="{{ act.image.url }}" alt="Image {{ act.titre }}" class="img-fluid">
                  <div class="mt-3">
                    <a href="{{ act.image.url }}" download class="btn btn-outline-success">
                      📥 Télécharger l’image
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}

        </div>
        {% empty %}
        <p class="text-muted">Aucune actualité pour le moment.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Colonne droite avec infos pratiques -->
    <div class="col-md-4">
      <div class="card mb-3">
        <div class="card-header bg-success text-white">🔔 Info importante</div>
        <div class="card-body">
          <p>Les inscriptions sont ouvertes jusqu’au <strong>30 août</strong>.</p>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-header bg-warning text-dark">📅 Événement à venir</div>
        <div class="card-body">
          <p><strong>Journée Portes Ouvertes</strong><br>15 juillet 2025 – N'Djamena</p>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-header bg-primary text-white">📎 Liens utiles</div>
        <div class="card-body">
          <ul class="list-unstyled">
            <li><a href="/formations/">📘 Formations</a></li>
            <li><a href="/inscription/">📝 Préinscription</a></li>
            <li><a href="/#contact">📞 Contact</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
